{% extends "admin/base_site.html" %}
{% load i18n static jazzmin %}
{% get_jazzmin_ui_tweaks as jazzmin_ui %}
{% load static %}

{% block bodyclass %}{{ block.super }} dashboard{% endblock %}

{% block content_title %} {% trans 'Dashboard' %} {% endblock %}

{% block extrastyle %}
    {{ block.super }}
    <!-- Your extra CSS -->
    <link rel="stylesheet" href="{% static 'css/custom_dashboard.css' %}">
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'images/favicon/favicon.ico' %}">


<!-- Libs CSS -->
<link href="{% static 'libs/bootstrap-icons/font/bootstrap-icons.min.css' %}" rel="stylesheet">
<link href="{% static 'libs/feather-webfont/dist/feather-icons.css' %}" rel="stylesheet">
<link href="{% static 'libs/simplebar/dist/simplebar.min.css' %}" rel="stylesheet">


<!-- Theme CSS -->
<link rel="stylesheet" href="{% static 'css/theme.min.css' %}">


{% endblock %}




{% block content %}
    {% get_side_menu using="app_list" as dashboard_list %}
    {% if dashboard_list %}
        {% widthratio dashboard_list|length 2 1 as middle %}
    {% endif %}

       <!-- main -->
      <div class="container-fluid py-4">

            <!-- main wrapper -->
            <main class="main-content-wrapper">
               <section class="container">
                  <!-- row -->
   
  
                  <!-- table -->
                  <div class="table-responsive-xl mb-6 mb-lg-0">
                     <div class="row row-cols-1 row-cols-lg-3 g-4">
                        <div class="col-lg-6 col-md-6 col-sm-12 mb-6">
                           <!-- card -->
                           <div class="card h-100 card-lg">
                              <!-- card body -->
                              <div class="card-body p-6">
                                 <!-- heading -->
                                 <div class="d-flex justify-content-between align-items-center mb-6">
                                    <div>
                                       <h4 class="mb-0 fs-5">Earnings</h4>
                                    </div>
                                    <div class="icon-shape icon-md bg-light-danger text-dark-danger rounded-circle">
                                       <i class="bi bi-currency-dollar fs-5"></i>
                                    </div>
                                 </div>
                                 <!-- project number -->
                                 <div class="lh-1">
                                    <h1 class="mb-2 fw-bold fs-2">{{ monthly_revenue|floatformat:2 }} DA</h1>
                                    <span>Monthly revenue</span>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-12 mb-6">
                           <!-- card -->
                           <div class="card h-100 card-lg">
                              <!-- card body -->
                              <div class="card-body p-6">
                                 <!-- heading -->
                                 <div class="d-flex justify-content-between align-items-center mb-6">
                                    <div>
                                       <h4 class="mb-0 fs-5">Orders</h4>
                                    </div>
                                    <div class="icon-shape icon-md bg-light-warning text-dark-warning rounded-circle">
                                       <i class="bi bi-cart fs-5"></i>
                                    </div>
                                 </div>
                                 <!-- project number -->
                                 <div class="lh-1">
                                    <h1 class="mb-2 fw-bold fs-2">{{ total_orders }}</h1>
                                    <span>
                                        <span class="text-dark me-1">{{ new_orders }}+</span>
                                        New Sales
                                    </span>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-12 mb-6">
                           <!-- card -->
                           <div class="card h-100 card-lg">
                              <!-- card body -->
                              <div class="card-body p-6">
                                 <!-- heading -->
                                 <div class="d-flex justify-content-between align-items-center mb-6">
                                    <div>
                                       <h4 class="mb-0 fs-5">Customer</h4>
                                    </div>
                                    <div class="icon-shape icon-md bg-light-info text-dark-info rounded-circle">
                                       <i class="bi bi-people fs-5"></i>
                                    </div>
                                 </div>
                                 <!-- project number -->
                                 <div class="lh-1">
                                    <h1 class="mb-2 fw-bold fs-2">{{ total_customers }}</h1>
                                    <span>
                                       <span class="text-dark me-1">{{ new_customers }}+</span>
                                       new in 2 days
                                    </span>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>

                  <!-- row -->
                  <div class="row g-4 mt-2">
                     <div class="col-xl-8 col-lg-8 col-md-12 col-12 mb-6">
                        <!-- card -->
                        <div class="card h-100 card-lg">
                           <div class="card-body p-6">
                              <!-- heading -->
                              <div class="d-flex justify-content-between">
                                 <div>
                                    <h3 class="mb-4 fs-5">Revenue</h3>
                                  
                                 </div>
                                 <div>
                                    <!-- select option -->
<select class="form-select" id="yearSelect">
    {% for year in available_years %}
        <option value="{{ year }}" {% if year == selected_year %}selected{% endif %}>{{ year }}</option>
    {% endfor %}
</select>

                                 </div>
                              </div>
                              <script>
document.getElementById('yearSelect').addEventListener('change', function () {
    const selectedYear = this.value;
    const url = new URL(window.location.href);
    url.searchParams.set('year', selectedYear);
    window.location.href = url.toString();
});
</script>
                              <!-- chart -->
<div class="mt-6" style="min-height: 350px;">
    <canvas id="revenueChart"></canvas>
</div>
                           </div>
                        </div>
                     </div>
                     <div class="col-xl-4 col-lg-4 col-12 mb-6">
                        <!-- card -->
                        <div class="card h-100 card-lg">
                           <!-- card body -->
                           <div class="card-body p-6">
                              <!-- heading -->
                              <h3 class="mb-0 fs-5">Total Sales</h3>
<div class="mt-6 d-flex justify-content-center">
    <canvas id="totalSaleChart" width="200" height="200"
        data-men="{{ men_percent|default:0|floatformat:2 }}"
        data-women="{{ women_percent|default:0|floatformat:2 }}"
        data-kids="{{ kids_percent|default:0|floatformat:2 }}">
    </canvas>
</div>


                         


<div class="mt-4">
    <ul class="list-unstyled mb-0">
        <li class="mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8"
                 fill="currentColor" class="bi bi-circle-fill text-primary"
                 viewBox="0 0 16 16">
                <circle cx="8" cy="8" r="8" />
            </svg>
            <span class="ms-1">
                <span class="text-dark">Men</span>
                ({{ men_percent|default:0|floatformat:2 }}%)
            </span>
        </li>
        <li class="mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8"
                 fill="currentColor" class="bi bi-circle-fill text-warning"
                 viewBox="0 0 16 16">
                <circle cx="8" cy="8" r="8" />
            </svg>
            <span class="ms-1">
                <span class="text-dark">Women</span>
                ({{ women_percent|default:0|floatformat:2 }}%)
            </span>
        </li>
        <li>
            <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8"
                 fill="currentColor" class="bi bi-circle-fill text-info"
                 viewBox="0 0 16 16">
                <circle cx="8" cy="8" r="8" />
            </svg>
            <span class="ms-1">
                <span class="text-dark">Kids</span>
                ({{ kids_percent|default:0|floatformat:2 }}%)
            </span>
        </li>
    </ul>
</div>

                           </div>
                        </div>
                     </div>
                  </div>

 
                  
   
                  <!-- row -->
                  <div class="row g-4">
                     <div class="col-xl-12 col-lg-4 col-md-12 col-12 mb-6">
                        <div class="card h-100 card-lg">
                           <!-- heading -->
                           <div class="p-6">
                              <h3 class="mb-0 fs-5">Recent Order</h3>
                           </div>
                           <div class="card-body p-0">
                              <!-- table -->
                              <div class="table-responsive">
                                 <table class="table table-centered table-borderless text-nowrap table-hover">
                                    <thead class="bg-light">
                                       <tr>
                                <th scope="col">Order Number</th>
                                <th scope="col">Client</th>
                                <th scope="col">Order Date</th>
                                <th scope="col">Total Price</th>
                                       </tr>
                                    </thead>
                        <tbody>
                            {% for order in recent_orders %}
                            <tr>
                                <td>#FC{{ order.id|stringformat:"04d" }}</td>
                                <td>
                                    {% if order.client %}
                                        {{ order.client.user.get_full_name|default:order.client.user.username }}
                                    {% else %}
                                        Guest
                                    {% endif %}
                                </td>
                                <td>{{ order.created_at|date:"d M Y" }}</td>
                                <td>{{ order.total_price }} DA</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center">No recent orders</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                                 </table>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </section>
            </main>
         </div>
      </div>
<script src="{% static 'libs/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'libs/simplebar/dist/simplebar.min.js' %}"></script>

<!-- Theme JS -->
<script src="{% static 'js/theme.min.js' %}"></script>

      <script src="{% static 'libs/apexcharts/dist/apexcharts.min.js' %}"></script>
      <script src="{% static 'js/vendors/chart.js' %}"></script>

<script>
document.getElementById('yearSelect').addEventListener('change', function () {
    const year = this.value;
    const url = new URL(window.location.href);
    url.searchParams.set('year', year);
    window.location.href = url.toString();
});
</script>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    var ctx = document.getElementById("revenueChart").getContext("2d");
    var chartLabels = JSON.parse('{{ chart_labels|escapejs }}');
    var chartData = JSON.parse('{{ chart_data|escapejs }}');

    new Chart(ctx, {
        type: "line",
        data: {
            labels: chartLabels,
            datasets: [{
                label: "Revenue",
                data: chartData,
                borderColor: "#4e73df",
                backgroundColor: "rgba(78, 115, 223, 0.1)",
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' }
            }
        }
    });
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // Doughnut Chart
    var doughnutCanvas = document.getElementById("totalSaleChart");
    var men = parseFloat(doughnutCanvas.dataset.men);
    var women = parseFloat(doughnutCanvas.dataset.women);
    var kids = parseFloat(doughnutCanvas.dataset.kids);

    new Chart(doughnutCanvas, {
        type: "doughnut",
        data: {
            labels: ["Men", "Women", "Kids"],
            datasets: [{
                data: [men, women, kids],
                backgroundColor: ["#4e73df", "#f6c23e", "#36b9cc"],
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: "bottom" }
            }
        }
    });
});
</script>


{% endblock %}
