{% load static %}

<div class="col">
  <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
  <div class="card card-product h-100">
    <div class="card-body">
      <div class="text-center position-relative">
        <a href="#" data-bs-toggle="modal" data-bs-target="#quickViewModal{{ product.id }}">
          {% if product.image %}
          <div class="product-image-wrapper mb-3">
<img src="{{ product.image.url }}"
     alt="{{ product.name }}"
     class="mb-3 img-fluid product-image" /></div>
          {% else %}
          <div class="product-image-wrapper mb-3">
          <img src="{% static 'images/placeholder.png' %}" alt="No image" class="mb-3 img-fluid product-image" />
          </div>
          {% endif %}
        </a>

        <div class="card-product-action">
          <a href="#" class="btn-action" data-bs-toggle="modal" data-bs-target="#quickViewModal{{ product.id }}">
            <i class="bi bi-eye" data-bs-toggle="tooltip" data-bs-html="true" title="Quick View"></i>
          </a>
        </div>
      </div>

      <div class="text-small mb-1">
        <small class="text-muted text-decoration-none">{{ product.get_category_display }}</small>
      </div>

      <h2 class="fs-6">
        <a href="#" data-bs-toggle="modal" data-bs-target="#quickViewModal{{ product.id }}" class="text-inherit text-decoration-none">
          {{ product.name }}
        </a>
      </h2>

    <div>
  <small class="text-warning">
  {% with full_stars=product.rating|floatformat:0|add:"0" %}
      {% for i in "12345"|make_list %}
        {% if forloop.counter <= full_stars %}
          <i class="bi bi-star-fill"></i>
        {% else %}
          <i class="bi bi-star"></i>
        {% endif %}
      {% endfor %}
    {% endwith %}

  </small>
  <span class="text-muted small">{{ product.rating|default:"0.0" }}</span>
</div>



      <div class="d-flex justify-content-between align-items-center mt-3">
        <div>
          <span class="text-dark">{{ product.price|floatformat:2 }} DZD</span>
          {% if product.discount_price %}
            <span class="text-decoration-line-through text-muted">{{ product.discount_price|floatformat:2 }} DZD</span>
          {% endif %}
        </div>
        <div>
          <form method="POST" action="#">
            {% csrf_token %}
<button type="button"
        class="btn btn-primary btn-sm"
        data-bs-toggle="modal"
        data-bs-target="#quickViewModal{{ product.id }}">
  <i class="feather feather-plus"></i> Add
</button>


          </form>
        </div>
      </div>
    </div>
  </div>
</div>


  <!-- Modal -->
<div class="modal fade" id="quickViewModal{{ product.id }}" tabindex="-1" aria-hidden="true">
         <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
               <div class="modal-body p-8">
                  <div class="position-absolute top-0 end-0 me-3 mt-3">
                     <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="row">
                    <div class="col-lg-6">
  <div class="product productModal" id="productModal">
    <div>
      <div class="zoom product-image-1" onmousemove="zoom(event)">
        <img src="{{ product.image.url }}" alt="{{ product.name }}" />
      </div>
    </div>
  </div>
</div>

                     <div class="col-lg-6">
                        <div class="ps-lg-8 mt-6 mt-lg-0">
                           <a href="#!" class="mb-4 d-block">{{ product.category }}</a>
                           <h2 class="mb-1 h1">{{ product.name }}</h2>

                       <div class="mb-4">
  <small class="text-warning">
    {% with full_stars=product.rating|floatformat:0|add:"0" %}
      {% for i in "12345"|make_list %}
        {% if forloop.counter <= full_stars %}
          <i class="bi bi-star-fill"></i>
        {% else %}
          <i class="bi bi-star"></i>
        {% endif %}
      {% endfor %}
    {% endwith %}
  </small>
</div>


                     <div class="fs-4">
  {% if product.discount_price and product.discount_price < product.price %}
    <span class="fw-bold text-dark">{{ product.discount_price }} DZD</span>
    <span class="text-decoration-line-through text-muted">{{ product.price }} DZD</span>
    <span>
      <small class="fs-6 ms-2 text-danger">
        {% widthratio product.price|floatformat:"2"|floatformat:"0"|add:"-product.discount_price"|floatformat:"0" product.price 100 as discount %}
        {{ discount|stringformat:"d" }}% Off
      </small>
    </span>
  {% else %}
    <span class="fw-bold text-dark">{{ product.price }} DZD</span>
  {% endif %}
</div>



                           <hr class="my-6" />
<div class="mb-4 size-options" data-product-id="{{ product.id }}">
  {% for stock_item in product.stock.all %}
    {% if stock_item.quantity > 0 %}
<button
  type="button"
  class="btn btn-outline-secondary size-btn"
  data-size="{{ stock_item.size }}"
  {% if stock_item.quantity == 0 %}disabled{% endif %}>
  {{ stock_item.size }}
</button>

    {% endif %}
  {% endfor %}
</div>





                           <div>
                              <!-- input -->
                              <!-- input -->
<div class="input-group input-spinner">
  <button type="button" class="button-minus btn btn-outline-secondary btn-sm px-3">âˆ’</button>
  <input type="number" step="1" max="10" value="1" name="quantity" class="form-control form-control-sm text-center quantity-input" />
  <button type="button" class="button-plus btn btn-outline-secondary btn-sm px-3">+</button>
</div>


                           </div>
                           <div class="mt-3 row justify-content-start g-2 align-items-center">
                              <div class="col-lg-4 col-md-5 col-6 d-grid">
                                 <!-- button -->
                                 <!-- btn -->

<button
  type="button"
  class="btn btn-primary add-to-cart-btn mt-2"
  data-product-id="{{ product.id }}"
  data-size="{{ selected_size }}">
  <i class="feather-icon icon-shopping-bag me-2"></i> Add to cart
</button>


                              </div>
                            
                           </div>
                           <hr class="my-6" />
                           <div>
                              <table class="table table-borderless">
                                 <tbody>
                                   <tr>
  <td>Product Code:</td>
  <td>{{ product.code }}</td>
</tr>
<tr>
  <td>Availability:</td>
  <td>{% if product.available %}In Stock{% else %}Out of Stock{% endif %}</td>
</tr>
<tr>
  <td>Type:</td>
  <td>{{ product.type }}</td>
</tr>
<tr>
  <td>Shipping:</td>
  <td>
    <small>1 day shipping. <span class="text-muted">(Free pickup today)</span></small>
  </td>
</tr>

                                 </tbody>
                              </table>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div> 
         </div>
      </div>
<script src="{% static 'js/cart.js' %}"></script>
     <script src="{% static 'js/sidebar.js' %}"></script>

